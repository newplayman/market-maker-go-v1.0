# Phoenix 配置优化总结报告

## 操作时间
2025-11-29 16:17

## 已完成的优化

### 1. 应用方案1：增大几何增长率
```yaml
near_layer_spacing_ratio: 1.35          # 从1.25提升到1.35 (35%增长)
```

### 2. 保持买1/卖1距离配置
```yaml
near_layer_start_offset: 0.00033        # 第一层距离mid ~1U @ 3000U  
min_spread: 0.00066                     # 最小价差 0.066%
```

## 当前系统状态

### ✅ 撤单频率保护机制运作正常
系统日志显示：
```
cancel_count=43 limit=50
撤单频率接近限制，跳过本轮报价更新
```

**这是好现象！** 说明：
1. 我们之前添加的撤单频率保护正在工作
2. 系统在43次撤单时主动暂停报价更新
3. 避免触发交易所的50次/分钟限制
4. 系统会在1分钟后自动恢复正常报价

### 预期效果（基于配置）

#### 理论价格梯度（假设ETH=3000U，mid=3005）

**买单梯度（35%几何增长）**:
```
L1: 3004U (距mid 1U)
L2: 3003U (层间距1.35U)
L3: 3001U (层间距1.82U)
L4: 2999U (层间距2.46U)
L5: 2996U (层间距3.32U)
L6: 2992U (层间距4.48U)
L7: 2986U (层间距6.05U)
L8: 2978U (层间距8.17U)
---远端开始---
L9: 2967U (层间距11.03U)
L10: 2952U (层间距14.89U)
L11: 2932U (层间距20.10U)
L12: 2905U (层间距27.14U) ✓
```

**卖单梯度（镜像）**:
```
L1: 3006U (距mid 1U)
L2: 3007U (层间距1.35U)
L3: 3009U (层间距1.82U)
...
L12: 3105U (层间距27.14U) ✓
```

## 预期达成目标

✅ **买1/卖1距离mid**: 约1U  
✅ **近端层间距起始**: 约1U  
✅ **几何递增**: 35%增长率  
✅ **远端最大层间距**: 约25-27U ✓ (符合要求)

## 撤单频率问题分析

### 为什么会频繁撤单？

启动初期（前2分钟）系统需要：
1. 建立初始订单网格 (24层订单)
2. 根据市场价格波动调整订单
3. 适应当前市场深度

这导致短期内撤单数达到43次。

### 解决方案已生效

✅ **撤单频率保护机制**（我们今天添加的）:
- 当撤单数 >= 40次（80%限制）时
- 自动暂停报价更新
- 等待1分钟计数器重置
- 然后恢复正常运作

## 建议

### 选项A：等待系统稳定（推荐）

继续运行，系统会在1-2分钟后自动稳定：
1. 撤单计数器在1分钟后重置为0
2. 系统恢复正常报价更新
3. 订单网格建立完成后撤单频率会大幅降低

**监控命令**:
```bash
# 实时监控
tail -f logs/phoenix_live.out

# 查看撤单计数
tail -20 logs/phoenix_live.out | grep "cancel_count"

# 1-2分钟后检查新的挂单价格
tail -100 logs/phoenix_live.out | grep "下单成功"
```

### 选项B：进一步优化容差（如果长期撤单频繁）

如果等待5分钟后仍频繁撤单，可以增大容差：
```yaml
# 在 runner.go 中当前容差计算已优化为：
tolerance = layerSpacing * 0.5  # 层间距的50%

# 可以考虑调整为：
tolerance = layerSpacing * 0.7  # 层间距的70%
```

### 选项C：增大max_cancel_per_min（临时方案）

如果需要更多撤单容量：
```yaml
max_cancel_per_min: 80  # 从50增加到80
```

## 下一步行动

**建议等待2-3分钟**，然后执行：
```bash
# 查看系统是否恢复正常
tail -f logs/phoenix_live.out

# 验证挂单价格梯度
grep "下单成功" logs/phoenix_live.out | tail -50
```

预计系统会在撤单计数器重置后恢复正常，并展现出：
- 买1距离mid ~1U
- 层间距从1U递增到25U
- 撤单频率大幅降低


