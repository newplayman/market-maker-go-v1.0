# 🚨 WebSocket断流紧急修复

**问题**: 价格数据过期,WebSocket断流,无法挂单

---

## ✅ 已修复

### 问题原因
Binance可能不支持`depth10@1000ms`格式,导致WebSocket连接失败。

### 修复方案
**回滚到保守配置**:
```
depth10@1000ms → depth5@100ms
```

**为什么选择depth5@100ms**:
1. ✅ **depth5**: Binance官方文档确认支持
2. ✅ **100ms**: 最常用的更新频率,稳定性最好
3. ✅ **数据量**: 比depth20减少75%

---

## 📊 流量预期

**depth5@100ms vs depth20@500ms**:
```
层数: 5 vs 20 = 25%
频率: 100ms vs 500ms = 5倍

但是: 5层数据量只有20层的25%
所以: 25% × 5 = 125% (稍高)
```

**预期流量**: 约600-800k (仍比1.5M好很多)

---

## 🧪 测试步骤

### 1. 重启程序
```bash
./bin/phoenix -config configs/phoenix_live.yaml -log info
```

### 2. 检查启动日志
应该看到:
```
✅ "WebSocket压缩协商: permessage-deflate"
✅ "深度流已订阅"
✅ "深度更新" (持续出现)
```

### 3. 观察5-10分钟
- ✅ 价格数据不应过期
- ✅ 应该有订单挂出
- ✅ 流量应该稳定

---

## 📝 如果仍有问题

### 如果WebSocket仍然断流
可能需要:
1. 检查网络连接
2. 检查API key权限
3. 检查Binance服务状态

### 如果流量仍然很高
我们可以:
1. 降低到depth5@500ms (减少5倍频率)
2. 或者只监控1-2个交易对
3. 或者使用REST API轮询(最后手段)

---

## 🎯 下一步

1. **立即测试**: 看WebSocket是否稳定连接
2. **观察流量**: 是否在600-800k范围
3. **反馈结果**: 告诉我是否正常

---

**修复状态**: ✅ 已编译  
**配置**: depth5@100ms  
**预期**: WebSocket稳定,流量600-800k
