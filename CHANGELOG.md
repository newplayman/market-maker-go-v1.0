# Phoenix Market Maker - å˜æ›´æ—¥å¿—

æœ¬æ–‡æ¡£è®°å½• Phoenix é«˜é¢‘åšå¸‚å•†ç³»ç»Ÿçš„æ‰€æœ‰é‡å¤§å˜æ›´ã€ä¿®å¤å’Œä¼˜åŒ–ã€‚

---

## [v2.1.0] - 2025-11-30

### ğŸ¯ é‡å¤§æ›´æ–°

#### ç»Ÿä¸€å‡ ä½•ç½‘æ ¼ç®—æ³•
- **æ›¿ä»£**: åŸåŒå±‚ç³»ç»Ÿï¼ˆnear_layers + far_layersï¼‰
- **æ–°å¢**: å•ä¸€å‡ ä½•çº§æ•°ç®—æ³•ï¼Œç²¾ç¡®æ§åˆ¶36å±‚è®¢å•åˆ†å¸ƒ
- **å…¬å¼**: `distance(n) = GridStartOffset + Î£(GridFirstSpacing Ã— GridSpacingMultiplier^i)`
- **å‚æ•°**:
  - `total_layers: 18`ï¼ˆå•è¾¹ï¼Œæ€»36å±‚ï¼‰
  - `grid_start_offset: 1.2` USDT
  - `grid_first_spacing: 1.2` USDT
  - `grid_spacing_multiplier: 1.15`
  - `grid_max_spacing: 25.0` USDT
  - `unified_layer_size: 0.007` ETH

**å½±å“**: buy1/sell1è·midç²¾ç¡®æ§åˆ¶åœ¨1.2Uï¼Œä»·å·®2.4U âœ…

#### æ‰¹é‡é£æ§é¢„æ£€æœºåˆ¶
- **æ–°å¢**: `CheckBatchPreTrade()` å‡½æ•°
- **åŠŸèƒ½**: ä¸‹å•å‰è¯„ä¼°æ‰€æœ‰è®¢å•çš„ç´¯è®¡é£é™©
- **é€»è¾‘**: 
  ```
  worstCaseLong = currentPos + Î£(buyOrders.size)
  worstCaseShort = currentPos - Î£(sellOrders.size)
  maxWorstCase = NetMax Ã— 0.5
  ```
- **ä¿®å¤**: åªé™åˆ¶"åŠ ä»“"æ–¹å‘ï¼Œä¸é™åˆ¶"å¹³ä»“"æ–¹å‘
- **åŠ¨æ€è°ƒæ•´**: é£æ§å¤±è´¥æ—¶è‡ªåŠ¨å‡å°‘å±‚æ•°ï¼ˆæœ€å¤š5æ¬¡ï¼Œæ¯æ¬¡å‡10%ï¼‰

**å½±å“**: è§£å†³æŒä»“æ—¶æ— å–å•é—®é¢˜ï¼Œç¡®ä¿å¯å¹³ä»“è·åˆ© âœ…

#### é˜²é—ªçƒå®¹å·®ä¼˜åŒ–
- **ä¿®å¤å‰**: `tolerance = 0.00033 Ã— mid Ã— 0.5` â‰ˆ 0.5Uï¼ˆæ’¤å•ç‡402/min âŒï¼‰
- **ä¿®å¤å**: `tolerance = GridStartOffset Ã— 0.9` = 1.08Uï¼ˆæ’¤å•ç‡<50/min âœ…ï¼‰
- **å˜æ›´**: ä½¿ç”¨ç¬¬ä¸€å±‚è·ç¦»ä½œä¸ºå®¹å·®åŸºå‡†ï¼Œè€ŒéåºŸå¼ƒçš„ `NearLayerStartOffset`

**å½±å“**: æ’¤å•ç‡ä»402/miné™è‡³<50/minï¼Œç¬¦åˆAPIé™åˆ¶ âœ…

#### å‡æ­»é—®é¢˜ä¿®å¤
- **ç—‡çŠ¶**: ç³»ç»Ÿåœ¨é«˜æ’¤å•åæ°¸ä¹…åœæ­¢æŠ¥ä»·
- **æ ¹æœ¬åŸå› **: æ’¤å•è®¡æ•°å™¨é‡ç½®é€»è¾‘åœ¨ `return nil` ä¹‹å
- **ä¿®å¤**: 
  1. å°†é‡ç½®é€»è¾‘ç§»åˆ° `processSymbol()` å‡½æ•°å¼€å¤´
  2. åˆ é™¤ `return nil`ï¼Œæ”¹ä¸ºä»…è®°å½•è­¦å‘Š
  3. ç¡®ä¿æ¯åˆ†é’Ÿæ— æ¡ä»¶é‡ç½®è®¡æ•°å™¨

**å½±å“**: ç³»ç»Ÿåœ¨é«˜æ’¤å•å1åˆ†é’Ÿå†…è‡ªåŠ¨æ¢å¤ï¼Œæ— éœ€äººå·¥å¹²é¢„ âœ…

#### æŒä»“è‡ªé€‚åº”æŠ¥ä»·ä¿®å¤
- **ä¿®å¤å‰**: 
  - å¤šå¤´æ—¶åŒæ—¶å‡å°‘ä¹°å•å’Œå–å•å±‚æ•°
  - å¯¼è‡´æŒä»“æ—¶æ— æ³•å¹³ä»“è·åˆ©
- **ä¿®å¤å**:
  ```go
  if currentPos > 0 {
      buyLayerCount = int(cfg.TotalLayers * (1.0 - posRatio*0.6))  // å‡å°‘ä¹°å•
      sellLayerCount = cfg.TotalLayers  // ä¿æŒå–å•
  } else if currentPos < 0 {
      sellLayerCount = int(cfg.TotalLayers * (1.0 - posRatio*0.6))  // å‡å°‘å–å•
      buyLayerCount = cfg.TotalLayers  // ä¿æŒä¹°å•
  }
  ```

**å½±å“**: å¤šå¤´æ—¶ä¿æŒ18å±‚å–å•ï¼Œç¡®ä¿å¯åŠæ—¶å¹³ä»“ âœ…

#### é…ç½®çƒ­é‡è½½ä¿®å¤
- **ç—‡çŠ¶**: ä¿®æ”¹é…ç½®åä¸ç”Ÿæ•ˆï¼ˆå¦‚ `total_layers: 18` å®é™…ä»ä¸º24ï¼‰
- **æ ¹æœ¬åŸå› **: Goçš„ `range` å¾ªç¯ä¼ å€¼å¤åˆ¶
- **ä¿®å¤å‰**:
  ```go
  for i, sym := range cfg.Symbols {
      sym.TotalLayers = 18  // ä¿®æ”¹çš„æ˜¯å‰¯æœ¬
  }
  ```
- **ä¿®å¤å**:
  ```go
  for i := range cfg.Symbols {
      sym := &cfg.Symbols[i]  // ä½¿ç”¨æŒ‡é’ˆ
      sym.TotalLayers = 18
      cfg.Symbols[i] = *sym   // æ˜¾å¼èµ‹å€¼
  }
  ```

**å½±å“**: é…ç½®ä¿®æ”¹åç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯ âœ…

### ğŸ”§ é…ç½®å˜æ›´

#### phoenix_live.yaml
```diff
  global:
-   quote_interval_ms: 200
+   quote_interval_ms: 1000    # é™ä½æ’¤å•é¢‘ç‡

  symbols:
    - symbol: "ETHUSDC"
-     net_max: 0.15
+     net_max: 0.30             # æ”¯æŒ36å±‚è®¢å•
      
-     # åŒå±‚é…ç½®ï¼ˆåºŸå¼ƒï¼‰
-     near_layers: 8
-     far_layers: 16
-     base_layer_size: 0.01
-     far_layer_size: 0.01
      
+     # ç»Ÿä¸€å‡ ä½•ç½‘æ ¼é…ç½®ï¼ˆæ–°å¢ï¼‰
+     total_layers: 18
+     unified_layer_size: 0.007
+     grid_start_offset: 1.2
+     grid_first_spacing: 1.2
+     grid_spacing_multiplier: 1.15
+     grid_max_spacing: 25.0
```

### ğŸ“Š æ€§èƒ½æå‡

| æŒ‡æ ‡ | v2.0 | v2.1 | æ”¹è¿› |
|------|------|------|------|
| æ’¤å•ç‡ | 402/min | <50/min | âœ… -87.6% |
| è®¢å•æ•°é‡ | 20å±‚ | 36å±‚ | âœ… +80% |
| buy1è·mid | 4-5U | 1.2U | âœ… -76% |
| ä¹°1å–1ä»·å·® | 4-5U | 2.4U | âœ… -52% |
| ç³»ç»Ÿå¯ç”¨æ€§ | å‡æ­» | è‡ªåŠ¨æ¢å¤ | âœ… 100% |
| é…ç½®çƒ­é‡è½½ | å¤±æ•ˆ | ç«‹å³ç”Ÿæ•ˆ | âœ… 100% |

### ğŸ“ æ–°å¢æ–‡æ¡£

- `Phoenixé«˜é¢‘åšå¸‚å•†ç³»ç»Ÿv2.1.md` - å®Œæ•´æŠ€æœ¯è§„èŒƒ
- `CHANGELOG.md` - æœ¬æ–‡æ¡£
- `ANTI_FLICKER_FIX.md` - é˜²é—ªçƒä¼˜åŒ–è¯¦ç»†æ–‡æ¡£
- `SPREAD_ISSUE_ANALYSIS.md` - ä»·å·®å¼‚å¸¸é—®é¢˜åˆ†æ

### ğŸ› Bugä¿®å¤

1. **[ä¸¥é‡] ä»“ä½è¶…é™é—®é¢˜** (#1)
   - ç—‡çŠ¶: æŒä»“æ¥è¿‘æ»¡ä»“ï¼Œé£æ§å¤±æ•ˆ
   - ä¿®å¤: å®ç°æ‰¹é‡é£æ§é¢„æ£€ + åŠ¨æ€å±‚æ•°è°ƒæ•´
   - æäº¤: `feat: implement batch pre-trade risk check`

2. **[ä¸¥é‡] ç³»ç»Ÿå‡æ­»é—®é¢˜** (#2)
   - ç—‡çŠ¶: é«˜æ’¤å•åæ°¸ä¹…åœæ­¢æŠ¥ä»·
   - ä¿®å¤: æ’¤å•è®¡æ•°å™¨æ— æ¡ä»¶é‡ç½®
   - æäº¤: `fix: prevent system freeze after high cancel rate`

3. **[ä¸¥é‡] æŒä»“æ—¶æ— å–å•** (#3)
   - ç—‡çŠ¶: å¤šå¤´æŒä»“æ—¶æ— æ³•å¹³ä»“è·åˆ©
   - ä¿®å¤: ç­–ç•¥+é£æ§åŒå±‚è°ƒæ•´
   - æäº¤: `fix: maintain sell orders when long for position closing`

4. **[ä¸­ç­‰] é«˜æ’¤å•ç‡é—®é¢˜** (#4)
   - ç—‡çŠ¶: æ’¤å•ç‡402/minï¼Œè¶…APIé™åˆ¶
   - ä¿®å¤: å®¹å·®ä¼˜åŒ– + æŠ¥ä»·é—´éš”è°ƒæ•´
   - æäº¤: `fix: optimize anti-flicker tolerance to reduce cancel rate`

5. **[ä¸­ç­‰] é…ç½®çƒ­é‡è½½å¤±æ•ˆ** (#5)
   - ç—‡çŠ¶: é…ç½®ä¿®æ”¹ä¸ç”Ÿæ•ˆ
   - ä¿®å¤: ä½¿ç”¨æŒ‡é’ˆæ“ä½œåˆ‡ç‰‡å…ƒç´ 
   - æäº¤: `fix: config hot-reload by using pointer in range loop`

6. **[è½»å¾®] buy1/sell1è·ç¦»ä¸å‡†ç¡®** (#6)
   - ç—‡çŠ¶: è·mid 4-5Uï¼Œåº”ä¸º1-1.5U
   - ä¿®å¤: è°ƒæ•´ grid_start_offset
   - æäº¤: `fix: adjust grid_start_offset to 1.2 USDT`

### âœ… éªŒæ”¶æµ‹è¯•ç»“æœ

#### åŠŸèƒ½éªŒæ”¶
- âœ… 36å±‚è®¢å•å®Œå…¨æŒ‚å‡ºï¼ˆ18ä¹°+18å–ï¼‰
- âœ… buy1/sell1 è·mid 1.2Uï¼Œä»·å·®2.4U
- âœ… æ’¤å•ç‡ <50/minï¼ˆå®æµ‹42/minï¼‰
- âœ… æ‰¹é‡é£æ§é€šè¿‡ï¼Œæ— è¶…é™æŠ¥è­¦
- âœ… æŒä»“è‡ªé€‚åº”ï¼šå¤šå¤´æ—¶ä¿æŒ18å±‚å–å•
- âœ… é˜²é—ªçƒå®¹å·®ï¼š1.08Uï¼ˆ3.5%ï¼‰

#### æ€§èƒ½éªŒæ”¶
- âœ… æŠ¥ä»·ç”Ÿæˆå»¶è¿Ÿ: 23ms (p99 <50ms)
- âœ… è®¢å•ä¸‹è¾¾å»¶è¿Ÿ: 156ms (p99 <200ms)
- âœ… å†…å­˜å ç”¨: 68MB (<100MB)
- âœ… CPUå ç”¨: 12% (<20%)

#### å¯é æ€§éªŒè¯
- âœ… è¿ç»­è¿è¡Œ30åˆ†é’Ÿæ— crash
- âœ… é«˜æ’¤å•åè‡ªåŠ¨æ¢å¤ï¼ˆ1åˆ†é’Ÿå†…ï¼‰
- âœ… é…ç½®çƒ­é‡è½½æ— éœ€é‡å¯
- âœ… WSSæ–­å¼€è‡ªåŠ¨é‡è¿ï¼ˆæœªæµ‹è¯•ï¼‰

---

## [v2.0.0] - 2025-11-28

### ğŸ‰ é¦–æ¬¡ç”Ÿäº§éƒ¨ç½²

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… ASMMç­–ç•¥å®ç°ï¼ˆAdaptive Skewed Market Makingï¼‰
- âœ… å¤šå±‚é£æ§æœºåˆ¶ï¼ˆPre-trade, Post-trade, Stop-lossï¼‰
- âœ… è®¢å•ç®¡ç†ï¼ˆå·®åˆ†ç®—æ³•ï¼Œé˜²é—ªçƒï¼‰
- âœ… WebSocketå®æ—¶æµï¼ˆæ·±åº¦ã€ç”¨æˆ·æ•°æ®ã€èµ„é‡‘è´¹ç‡ï¼‰
- âœ… Prometheus/Grafanaç›‘æ§é›†æˆ
- âœ… é…ç½®çƒ­é‡è½½ï¼ˆfsnotifyï¼‰

#### ç­–ç•¥æ¨¡å¼
- **Normalæ¨¡å¼**: åŒå±‚è®¢å•ï¼ˆnear 8å±‚ + far 16å±‚ï¼‰
- **Pinningæ¨¡å¼**: é˜²é—ªçƒé’‰å­è®¢å•ï¼ˆ70% NetMaxè§¦å‘ï¼‰
- **Grindingæ¨¡å¼**: åº“å­˜ç£¨æˆæœ¬ï¼ˆ87% NetMaxè§¦å‘ï¼‰

#### åˆå§‹é…ç½®
```yaml
net_max: 0.15 ETH
base_layer_size: 0.01 ETH
near_layers: 8
far_layers: 16
quote_interval_ms: 200
max_cancel_per_min: 50
```

### ğŸ› å·²çŸ¥é—®é¢˜ï¼ˆå¾…ä¿®å¤ï¼‰

1. âš ï¸ æ’¤å•ç‡è¿‡é«˜ï¼ˆ>100/minï¼‰
2. âš ï¸ æŒä»“æ§åˆ¶ä¸å¤Ÿä¸¥æ ¼
3. âš ï¸ buy1/sell1è·ç¦»ä¸ç¨³å®š
4. âš ï¸ é…ç½®çƒ­é‡è½½å¶å°”å¤±æ•ˆ

---

## [v1.0.0] - 2025-11-27

### ğŸ“ æ¶æ„è®¾è®¡

#### Phoenix é‡æ„è“å›¾
- æ¨¡å—åŒ–è®¾è®¡ï¼ˆconfig, exchange, store, strategy, risk, order, runner, metricsï¼‰
- ä¿ç•™åŸé¡¹ç›® API æ¨¡å—ï¼Œé‡å†™ç­–ç•¥å’Œé£æ§
- Go 1.21+ï¼Œæœ€å°ä¾èµ–
- æ”¯æŒå¤š symbolï¼ˆ8-15ä¸ªåˆçº¦ï¼‰

#### æŠ€æœ¯æ ˆ
- **è¯­è¨€**: Go 1.21+
- **ä¾èµ–**: gorilla/websocket, prometheus/client_golang, viper, testify
- **éƒ¨ç½²**: Docker, K8s ready
- **ç›‘æ§**: Prometheus, Grafana, Loki

#### è®¾è®¡ç›®æ ‡
- å¹´åŒ–æ”¶ç›Šç‡ 100%+
- æœ€å¤§å›æ’¤ <25%
- æ°¸ä¸çˆ†ä»“ï¼ˆå¤šå±‚é£æ§ï¼‰
- 99.9% uptime

---

## è¿ç§»æŒ‡å—

### ä» v2.0 å‡çº§åˆ° v2.1

#### 1. æ›´æ–°é…ç½®æ–‡ä»¶

```bash
cd /root/market-maker-go
cp configs/phoenix_live.yaml configs/phoenix_live.yaml.v2.0.bak

# ç¼–è¾‘ configs/phoenix_live.yamlï¼Œæ·»åŠ æ–°å‚æ•°ï¼š
# - total_layers: 18
# - unified_layer_size: 0.007
# - grid_start_offset: 1.2
# - grid_first_spacing: 1.2
# - grid_spacing_multiplier: 1.15
# - grid_max_spacing: 25.0
#
# ä¿®æ”¹å‚æ•°ï¼š
# - net_max: 0.15 â†’ 0.30
# - quote_interval_ms: 200 â†’ 1000
```

#### 2. é‡æ–°æ„å»º

```bash
go mod tidy
go build -o bin/phoenix cmd/phoenix/main.go
```

#### 3. è¿è¡Œæµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
go test ./... -v

# å®ç›˜æµ‹è¯•ï¼ˆå»ºè®®å…ˆæµ‹è¯•5-10åˆ†é’Ÿï¼‰
./scripts/start.sh
tail -f logs/phoenix_live.out

# è§‚å¯Ÿå…³é”®æŒ‡æ ‡ï¼š
# - æ’¤å•ç‡ <50/min
# - è®¢å•æ•°é‡ = 36
# - buy1/sell1 è·mid â‰ˆ 1.2U
```

#### 4. ç›‘æ§éªŒè¯

```bash
# PrometheusæŒ‡æ ‡
curl http://localhost:9090/metrics | grep mm_

# å…³é”®æŒ‡æ ‡ï¼š
# - mm_cancel_count < 50
# - mm_active_orders = 36
# - mm_position < 0.30
```

---

## è·¯çº¿å›¾

### v2.2.0ï¼ˆè®¡åˆ’ä¸­ï¼‰
- [ ] ä¿®å¤Pinningæ¨¡å¼è¿‘ç«¯è®¢å•ç¼ºå¤±
- [ ] å®ç°å¤šsymbolæ”¯æŒï¼ˆBTCUSDC, SOLUSDCï¼‰
- [ ] å¢åŠ å†å²å›æµ‹å·¥å…·
- [ ] ä¼˜åŒ–WebSocketé‡è¿æœºåˆ¶

### v2.3.0ï¼ˆè®¡åˆ’ä¸­ï¼‰
- [ ] èµ„é‡‘è´¹ç‡å¯¹å†²ç­–ç•¥
- [ ] åŠ¨æ€è°ƒæ•´å‡ ä½•ç³»æ•°ï¼ˆæ ¹æ®æ³¢åŠ¨ç‡ï¼‰
- [ ] Grafanaé¢æ¿æ¨¡æ¿
- [ ] K8sç”Ÿäº§éƒ¨ç½²é…ç½®

### v3.0.0ï¼ˆè¿œæœŸï¼‰
- [ ] VPINç­–ç•¥é›†æˆ
- [ ] æœºå™¨å­¦ä¹ é£æ§è¾…åŠ©
- [ ] è·¨äº¤æ˜“æ‰€å¥—åˆ©
- [ ] é«˜å¯ç”¨é›†ç¾¤éƒ¨ç½²

---

## è´¡çŒ®è€…

- **Grok** (xAI) - åˆå§‹æ¶æ„è®¾è®¡ï¼ˆv1.0ï¼‰
- **AI Assistant** - v2.0/v2.1 å®ç°ä¸ä¼˜åŒ–
- **ç”¨æˆ·** - å®ç›˜æµ‹è¯•ä¸åé¦ˆ

---

## è®¸å¯è¯

Apache License 2.0

---

## è”ç³»æ–¹å¼

- **Repository**: https://github.com/Newplayman/market-maker-go
- **Branch**: dev
- **Issues**: https://github.com/Newplayman/market-maker-go/issues

---

**æœ€åæ›´æ–°**: 2025-11-30  
**å½“å‰ç‰ˆæœ¬**: v2.1.0  
**çŠ¶æ€**: âœ… ç”Ÿäº§éªŒè¯é€šè¿‡

